# EVM CCIP-Read Gateway
This repository implements a generic CCIP-Read gateway for fetching state proofs of data on other EVM chains.
The intended use is for contracts on L1 to be able to fetch and verify data from contracts on L2 in a read context.

The gateway implements the following interface:
```
interface IEVML2Gateway {
    /**
     * @dev Gateway function to fetch storage proofs for multiple slots within a contract.
     *      Supports dynamic length values and slot numbers derived from other retrieved values.
     * @param addr The address of the L2 contract to fetch storage proofs for.
     * @param paths An array of paths for storage slots to retrieve.
     *        Each element in `paths` specifies a series of hashing operations to derive the final slot ID.
     *        See https://docs.soliditylang.org/en/v0.8.17/internals/layout_in_storage.html for details on how Solidity lays out storage variables.
     *        In order to support additional functionality, special values are permitted for each element of a path.
     *        The MSB of the first element of a path is reserved to indicate if the value to be retrieved is fixed or dynamic length. If the MSB is 1,
     *        the value is treated as a dynamic length Solidity type and retrieved as such.
     *        Each subsequent element of the path has an arbitrary value, MAGIC_SLOT subtracted from it; if the result is less than the number of previous
     *        entries, the value of the previous entry is substituted.
     *
     *        The following examples assume a Solidity contract with the following storage mapping:
     *        ```
     *        contract Test {
                uint256 latest;
                string name;
                mapping(uint256=>uint256) highscores;
                mapping(uint256=>string) highscorers;
     *        }
     *        ```
     *        Examples:
     *          `[[0x0]]` - Fetches a fixed-length storage proof for `latest`.
     *          `[[0x8...1]]` - Fetches a dynamic-length storage proof for `name`.
     *          `[[0x2, 0x0]]` - Fetches a fixed-length storage proof for `highscores[0]`.
     *          `[[0x8...3, 0x0]]` - Fetches a dynamic-length storage proof for `highscorers[0]`.
     *          `[[0x0], [0x2, MAGIC_SLOT], [0x8...3, MAGIC_SLOT]]` - Fetches fixed length storage proofs for `latest` and `highscores[latest]` and a
     *            dynamic-length storage proof for `highscorers[latest]`.
     */
    function getStorageSlots(address addr, uint256[][] memory paths) external view returns(bytes memory witness);
}
```

A corresponding library is provided, which verifies proofs generated by the gateway:

```
interface EVML2ProofVerifier {
    function getSlotValues(address addr, uint256[][] memory paths, bytes memory witness) external view returns(bytes[] memory values);
}
```

# Usage

To follow.
